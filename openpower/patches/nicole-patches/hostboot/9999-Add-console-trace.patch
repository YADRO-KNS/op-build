From 32e32a9df09c78c55242423effa8ff895e58afb6 Mon Sep 17 00:00:00 2001
From: Artem Senichev <a.senichev@yadro.com>
Date: Tue, 19 Nov 2019 14:02:23 +0300
Subject: [PATCH] Add console trace

Signed-off-by: Artem Senichev <a.senichev@yadro.com>
---
 src/usr/isteps/nvdimm/nvdimm.C | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/src/usr/isteps/nvdimm/nvdimm.C b/src/usr/isteps/nvdimm/nvdimm.C
index 286295b9c..6dfe989af 100644
--- a/src/usr/isteps/nvdimm/nvdimm.C
+++ b/src/usr/isteps/nvdimm/nvdimm.C
@@ -67,6 +67,13 @@ TRAC_INIT(&g_trac_nvdimm, NVDIMM_COMP_NAME, 2*KILOBYTE);
 //#define TRACUCOMP(args...)  TRACFCOMP(args)
 #define TRACUCOMP(args...)
 
+#ifndef __HOSTBOOT_RUNTIME
+#include <console/consoleif.H>
+#undef TRACFCOMP
+#define TRACFCOMP(dummy, _fmt_, _args_...) { CONSOLE::displayf(NULL, "NVDIMM: " _fmt_ " at %s:%i", ##_args_, __FILE__, __LINE__); CONSOLE::flush(); }
+#undef TRACUCOMP
+#define TRACUCOMP TRACFCOMP
+#endif // __HOSTBOOT_RUNTIME
 
 namespace NVDIMM
 {
-- 
2.23.0

